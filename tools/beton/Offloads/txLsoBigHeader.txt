# $File: //depot/icm/proj/Atlantic/rev1.0/software/Software/Test/AtlanticTestbench/Offloads/txLsoBigHeader.txt $
# $Revision: #2 $
# $DateTime: 2016/07/22 01:35:19 $
# $Author: dgubanov $
#
# LSO for 142b header
finalReport = []

mac.set loopback System Packet
mac.txring[0].set PacketMark None
mac.txring[0].set bufSize 8192
mac.txring[0].set maxDmaSize 8192
mac.init
mac.isr.disable
mac.txinit
mac.rxinit
mac.txring[0].enable
mac.rxring[0].enable
mac.rxring[0].fill
mac.rxring[0].commit


#ifndef TPO2:
#    TPO2 = False 
#    
#if $TPO2:
#    exec $(PWD)/helpers/enableTPO2.txt    

mac.llh tpoIpv4HeaderChecksumOffloadEnableSet 1
mac.llh tpoTcpUdpChecksumOffloadEnableSet 1
mac.llh tdmLargeSendOffloadEnableSet 0xFFFFFFFF

mac.llh thmLsoTcpFlagOfFirstPacketSet 0x0FF6
mac.llh thmLsoTcpFlagOfMiddlePacketSet 0x0FF6
mac.llh thmLsoTcpFlagOfLastPacketSet 0x0F7F
mac.llh regTxLargeSendOffloadTcpControl1Set 0xFFFFFFFF
mac.llh regTxLargeSendOffloadTcpControl2Set 0xFFFFFFFF

l2 = 22
l3 = 60
l4 = 60

totalHeaderSize = $l2 + $l3 + $l4

mac.txring[0].insertcontext -I 0 -M 0x04 -S 100 -E $l2 -P $l3 -T $l4 -O 0 -U 0

ipOptions = " "

eop = 0
sop = 1

packetCount = 1
packetSize = 0x13e

packet = 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x08 0x00 0x4F 0x00 0x01 0x8E 0x00 0x01 0x00 0x00 0x40 0x06 0x5E 0x40 0x7F 0x00 0x00 0x01 0x7F 0x00 0x00 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x00 0x14 0x00 0x50 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x60 0x02 0xF0 0x00 0x97 0x04 0x04 0x40 0x03 0x03 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
packet = 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x88 0xA8 0xA7 0xD0 0x81 0x00 0xA5 0x41 0x08 0x00 0x4F 0x00 0x01 0x8E 0x00 0x01 0x00 0x00 0x40 0x06 0x5E 0x40 0x7F 0x00 0x00 0x01 0x7F 0x00 0x00 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x00 0x14 0x00 0x50 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x60 0x02 0xF0 0x00 0x97 0x04 0x04 0x40 0x03 0x03 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0x01 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
packetLen = '$packet'.count('0x')

mac.txring[0].insert -b $packetSize -p $packetSize -l 1 -e 1 -u 1 -s 1 -m 0x10 -C 0 -f ramp

mac.txring[0].getdescval -T 1 -f bufferAddress -n pAddr

mem.put $packet -s 1 -p $pAddr

#pkt.new -n pkt$i -p $packetSize
#pkt.layer -i $(pkt$i) -L 40 -t TCP options=[('WScale',100)]
#pkt.layer -i $(pkt$i) -L 30 -t IP options=IPOption("\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01")
#pkt.layer -i $(pkt$i) -L 20 -t Ether type=0x0800
#mac.txring[0].insert -i $(pkt$i) -b $packetSize -p $packetSize -l 1 -e 1 -u 1 -s 1 -m 0x10 -C 0

mac.txring[0].dumpdesc -T 3:1
mac.txring[0].commit

pause 10 ms

mac.txring[0].clean
mac.rxring[0].clean
mac.txring[0].dumpbuf -H 1 --size 80
mac.rxring[0].dumpbuf -H 3:1 --size 80
mac.rxring[0].status
mac.rxring[0].status
mac.llh -v rdmRxDescriptorHeadPointer rdmRxDescriptorHeadPointerGet 0

echo $rdmRxDescriptorHeadPointer

mac.uninit